{% extends "base.html" %}

{% block content %}
<body class="zap-page">
<h1>Welcome to the ZAP Scanner</h1>
<form id="zapScanForm">
    <div class="form-group">
        <label for="target">URI you are scanning:</label>
        <input type="text" class="form-control" id="target" name="target" required>
    </div>
    <button type="submit" class="btn btn-primary">Initiate Scan</button>
</form>
<div id="scanStatus">
    <p id="statusMessage"></p>
    <div class="progress">
        <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
    </div>
    <pre id="scanResults"></pre>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
    var socket = io();

    document.getElementById('zapScanForm').onsubmit = function(e) {
        e.preventDefault();
        var target = document.getElementById('target').value;
        socket.emit('start_scan', {'target': target});
    };

    socket.on('scan_started', function(data) {
        document.getElementById('statusMessage').textContent = data.message;
        document.getElementById('progressBar').style.width = '0%';
        document.getElementById('scanResults').textContent = '';
    });

    socket.on('scan_progress', function(data) {
        document.getElementById('progressBar').style.width = data.progress + '%';
    });

    socket.on('scan_complete', function(data) {
        document.getElementById('statusMessage').textContent = 'Scan complete!';
        document.getElementById('progressBar').style.width = '100%';
        document.getElementById('scanResults').textContent = JSON.stringify(data.alerts, null, 2);
    });

    socket.on('scan_error', function(data) {
        document.getElementById('statusMessage').textContent = 'Scan error: ' + data.error;
        document.getElementById('progressBar').style.width = '0%';
    });
</script>
{% endblock %}